<!doctype html>
<html>
  <head>
    <style>
      @font-face {
        font-family: 'ia-quattro-v';
        src: url('fonts/iAWriterQuattroV.ttf') format('truetype');
      }

      @font-face {
        font-family: 'ia-quattro-s';
        src: url('fonts/iAWriterQuattroS-Regular.ttf') format('truetype');
      }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JIF</title>
    <link rel=stylesheet media=screen href="jif.css">
  </head>

  <body hbox=stretch ondrop="open_file(event)">
    <div id=sidebar flex=0 class=ui vbox=start-stretch></div>

    <div flex=1 vbox=stretch>
      <textarea id=ed scale=2
        autofocus autocomplete=off
      ></textarea>

      <div id=menu class=ui hbox=start-stretch></div>
    </div>

    <script src="jif.js"></script>

    <script>
      menu([
        ['File', [
          ['New File', () => console.log('new file')],
          ['New Window', () => console.log('new file')],
          '---',
          ['Open Files…', () => {choose_files()}],
          '---',
          ['Save', () => console.log('save file')],
          ['Rename…', () => console.log('rename')],
          '---',
          ['Page Setup…', () => console.log('print setup')],
        ]],
        ['Options', [
          ['Edit Config', show_config],
          ['Spell', toggle_spell],
          ['Show Sidebar', () => togvis('#sidebar')]
        ]],
        '---',
        ['Cmd', [
          ['Enter Command', show_cli],
          ['View Log', show_log],
        ]],
        ['Stats', [
          ['chars'],
          ['words'],
        ]]
      ])

      $('#menu-Stats').on('mousedown', e => {
        let s = stat_calc()
        let nc = s.nchars.toLocaleString()
        let nw = s.nwords.toLocaleString()
        $('#menu-Stats-chars').innerText = nc+' Characters'
        $('#menu-Stats-words').innerText = nw+' Words'
      })

      configure(db.get('=config'))

      set_scale(db.get('scale') ?? 0)
      toggle_spell(db.get('spell') ?? false)

      if (location.hash == '#menu')
        togvis('#menu', true)
      else
        togvis('#menu', db.get('vis/menu') ?? true)

      togvis('#sidebar', db.get('vis/sidebar') ?? false)


      // temporary
      JIF.autoload('x').then(x => ed.value = x)

      window.on('beforeunload', () =>
        JIF.autosave('x', ed.value))

    </script>
  </body>
</html>

